limit_req_zone $binary_remote_addr zone=mylimit:10m rate=10r/s;

upstream cudurru-services {
   server 127.0.0.1:8080;
}

gzip_http_version 1.0;
gzip_proxied      any;
gzip_min_length   500;
gzip_disable      "MSIE [1-6]\.";
gzip_types        text/plain text/xml text/css
                  text/javascript
                  application/javascript;

server {
    access_log off;

    keepalive_timeout 120;
    keepalive_requests 100000;
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    client_max_body_size 26M;
    location / {
        try_files $uri $uri /index.html;
        limit_req zone=mylimit burst=20 nodelay;
    }

    location ^~ /api {
      proxy_pass         http://cudurru-services;
      proxy_redirect     off;
      proxy_set_header   Host $host;
      proxy_set_header   X-Real-IP $remote_addr;
      proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header   X-Forwarded-Host $server_name;
    }

    location ^~ /static {
        alias /opt/cudurru-services/prelude/tmp;   
        autoindex on;
    }

    root {{ frontend_dist_path }};
    listen 80;
    listen [::]:80;
    server_name {{ server_name }};
    index index.html;
}
